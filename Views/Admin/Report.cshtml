@model BookStore.ViewModels.ReportViewModel

@{
    ViewBag.Title = "Report";
    Layout = "~/Views/Shared/Admin/_SideNav.cshtml";
}



<style>
    .body {
        background-color: #343434;
    }

    .main-content {
        padding: 20px;
    }

    .card {
        margin-bottom: 20px;
    }

    .sales-amount {
        font-size: 2rem;
        font-weight: bold;
        color: #007bff;
    }

    .category-bar {
        background-color: #007bff;
        height: 20px;
        border-radius: 5px;
    }

    .trend-percentage {
        color: #28a745;
        font-weight: bold;
    }

    .low-stock {
        border-left: 4px solid #ffc107;
        padding-left: 10px;
    }

    .out-of-stock {
        border-left: 4px solid #dc3545;
        padding-left: 10px;
    }

    .restocked {
        border-left: 4px solid #28a745;
        padding-left: 10px;
    }

    .stats-card {
        text-align: center;
        padding: 10px;
    }
</style>
@{var currentDate = DateTime.Now.ToString("d");}

<div class="container-fluid">
    <div class="main-content">
        <div class="d-flex justify-content-between mb-3">
            <h2>Reports</h2>
            <div>
                <button class="btn btn-outline-secondary btn-sm me-2">Export</button>
                <button class="btn btn-outline-secondary btn-sm">Share</button>
            </div>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="salesReport-tab" data-bs-toggle="tab" data-bs-target="#salesReport" type="button" role="tab" aria-controls="salesReport" aria-selected="true">Monthly Sales Report</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="inventoryStatus-tab" data-bs-toggle="tab" data-bs-target="#inventoryStatus" type="button" role="tab" aria-controls="inventoryStatus" aria-selected="false">Inventory Status</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="userActivity-tab" data-bs-toggle="tab" data-bs-target="#userActivity" type="button" role="tab" aria-controls="userActivity" aria-selected="false">User Activity Report</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="myTabContent">
            <!-- Monthly Sales Report Tab -->
            <div class="tab-pane fade show active" id="salesReport" role="tabpanel" aria-labelledby="salesReport-tab">
                <p class="text-muted">Generated on @currentDate</p>


                <!-- Total Sales -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>Total Sales</h5>
                                <p class="sales-amount">@Model.TotalSales</p>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="exportReport('sales')">Export</button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Sales by Category -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>Sales by Category</h5>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Fiction</span>
                                        <span>$8243.52</span>
                                    </div>
                                    <div class="progress">
                                        <div class="category-bar progress-bar" style="width: 70%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Selling Books -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>Top Selling Books</h5>
                                <ol>
                                    <li>
                                        <div class="d-flex justify-content-between">
                                            <span>The Great Gatsby</span>
                                            <span>32 copies</span>
                                        </div>
                                    </li>
                                    <!-- Add more top selling books -->
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Sales Trend -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5>Monthly Sales Trend</h5>
                            <span class="trend-percentage">+12.5%</span>
                        </div>
                        <p class="text-muted">[Graph placeholder]</p>
                    </div>
                </div>
            </div>

            <!-- Inventory Status Tab -->
            <div class="tab-pane fade" id="inventoryStatus" role="tabpanel" aria-labelledby="inventoryStatus-tab">
                <p class="text-muted">Generated on  @currentDate</p>

                <!-- Total Books in Inventory -->

                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>Total Books in Inventory</h5>
                                <p class="sales-amount"> @Model.BookCount</p> <!-- Display total number of books -->
                            </div>
                            <button class="btn btn-outline-primary btn-sm">Export</button>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <!-- Low Stock Items -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>Low Stock Items</h5>
                                <div class="low-stock mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Sapiens: A Brief History of Humankind</span>
                                        <span>12 left in stock</span>
                                    </div>
                                </div>
                                <!-- Add more low stock items -->
                            </div>
                        </div>
                    </div>

                    <!-- Out of Stock Items -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>Out of Stock Items</h5>
                                <div class="out-of-stock mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>1984</span>
                                        <span>by George Orwell</span>
                                    </div>
                                </div>
                                <!-- Add more out of stock items -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recently Restocked Items -->
                <div class="card">
                    <div class="card-body">
                        <h5>Recently Restocked Items</h5>
                        <div class="restocked mb-3">
                            <div class="d-flex justify-content-between">
                                <span>The Alchemist</span>
                                <span>+30 units 4/10/2025</span>
                            </div>
                        </div>
                        <!-- Add more recently restocked items -->
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="row">
                    <div class="col-md-4">
                        <div class="card stats-card">
                            <h5>6</h5>
                            <p>Unique Titles</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stats-card">
                            <h5>2</h5>
                            <p>Low Stock Items</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stats-card">
                            <h5>2</h5>
                            <p>Out of Stock Items</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Activity Report Tab -->
            <div class="tab-pane fade" id="userActivity" role="tabpanel" aria-labelledby="userActivity-tab">
                <!-- User Activity Report Content -->
                <p class="text-muted">Generated on @currentDate</p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>Total Users</h5>
                                <p class="sales-amount">@Model.TotalUsers</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>Active Users</h5>
                                <p class="sales-amount">@Model.ActiveUsers</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>New Users This Month</h5>
                                <p class="sales-amount">@Model.NewUsersThisMonth</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5>User Engagement</h5>
                                <p class="sales-amount">a</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5>Most Active Users</h5>
                        <ol>
                            @foreach (var user in Model.MostActiveUsers)
                            {
                                <li>
                                    <div class="d-flex justify-content-between">
                                        <span>@user.FullName</span>
                                        <span>@(user.Books?.Count ?? 0) actions</span>
                                    </div>
                                </li>
                            }
                        </ol>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5>Recent Logins</h5>
                        <ol>
                            @*@foreach (var login in Model.RecentLogins)
                            {*@
                                <li>
                                    <div class="d-flex justify-content-between">
                                        <span>a</span>
                                        <span>a</span>
                                    </div>
                                </li>
                            @*}*@
                        </ol>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function exportReport(reportType) {
            // Make an AJAX request to your backend to generate the invoice
            const url = `/Export/GenerateInvoice?reportType=${reportType}`;

            // Create a link to trigger the download
            const link = document.createElement('a');
            link.href = url;
            link.download = `invoice_${reportType}_${new Date().toISOString().slice(0, 10)}.pdf`; // Adjust the file name as needed

            // Append to the body and trigger the download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>

}